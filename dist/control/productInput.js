!function(a,b,c){b.control.set({name:"productInput",par:"type/id/state",tem:["top_second","product_input"],fn:function(c){function d(){var c=0;a("#scroller [D_type='number']").each(function(){c+=Number(a(this).find("input").val())});var d=h.man*h.date.g+h.child*h.date.h+h.child2*h.date.i+h.oldman*h.date.j+h.oldman2*h.date.k;h.single&&(d-=(c-h.child2)*h.date.l),c>1&&5>=c?(d-=h.date[f[c]]*c,a("[D_key='sell']").html("￥"+h.date[f[c]]*c+"元")):c>5?(d-=h.date.q*c,a("[D_key='sell']").html("￥"+h.date.q*c+"元")):a("[D_key='sell']").html("￥0元"),a("#scroller .totalPrice").html("￥"+d),a("#scroller #totalMan").html(c+"人"),a("#scroller #traveler").empty(),h.traveler||(h.traveler=[]);for(var e=[],g=0;c>g;g++)e[g]=h.traveler[g]||{b:"姓名"},a("#scroller #traveler").append('<div class="inputList"><div class="inputTitle">出游人'+(g+1)+'</div><input placeholder="姓名" readonly="true" value="'+e[g].b+'"/><div class="clear"></div></div>');h.traveler=e,a("#scroller [D_type='inputGroup']").unbind("change").bind("change",function(){b.control.pointParse(h,a(this).attr("D_key"))||b.control.pointParse(h,a(this).attr("D_key"),[""]),b.control.pointParse(h,a(this).attr("D_key"))[a(this).attr("D_num")]=a(this).val(),console.log(h)}),myScroll.refresh()}function e(e){var f=_.template(c.tem[1])(h);a("#scroller").html(f),d(),a("#scroller .payList u").unbind("tap").bind("tap",function(){b.bottom.on("pay_list",h,function(){},function(a){alert(JSON.stringify(a))})}),a("#scroller #postScript").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,h),window.location.hash="postScript/"+c.type+"/"+c.id+"/"+c.state}),a("#scroller #message").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,h),window.location.hash="dealMessage"}),a("#scroller #usefulEmail0").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,h),window.location.hash="usefulEmail/"+c.type+"/"+c.id+"/"+c.state+"/0"}),a("#scroller #usefulEmail1").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,h),window.location.hash="usefulEmail/"+c.type+"/"+c.id+"/"+c.state+"/1"}),a("#scroller #usefulInvoice").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,h),window.location.hash="usefulInvoice/"+c.type+"/"+c.id+"/"+c.state}),a("#scroller #usefulLinkman").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,h),window.location.hash="usefulLinkman/"+c.type+"/"+c.id+"/"+c.state}),a("#scroller #usefulTraveler").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,h),window.location.hash="usefulTraveler/"+c.type+"/"+c.id+"/"+c.state}),a("#scroller #date").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,h),window.location.hash="calendar/"+c.type+"/"+c.id+"/"+c.state+"/1"}),a("#scroller [D_type='input']").unbind("change").bind("change",function(){b.control.pointParse(h,a(this).attr("D_key"),a(this).val())}),a("#scroller [D_type='inputGroup']").unbind("change").bind("change",function(){b.control.pointParse(h,a(this).attr("D_key"))||b.control.pointParse(h,a(this).attr("D_key"),[""]),b.control.pointParse(h,a(this).attr("D_key"))[a(this).attr("D_num")]=a(this).val(),console.log(h)}),a("#scroller [D_type='number']").each(function(){var c=this;a(c).find(".numberSub").unbind("tap").bind("tap",function(){b.control.pointParse(h,a(c).attr("D_key"))&&b.control.pointParse(h,a(c).attr("D_key"))>0?b.control.pointParse(h,a(c).attr("D_key"),b.control.pointParse(h,a(c).attr("D_key"))-1):b.control.pointParse(h,a(c).attr("D_key"),0),a(c).find("input").val(b.control.pointParse(h,a(c).attr("D_key"))),d()}),a(c).find(".numberAdd").unbind("tap").bind("tap",function(){b.control.pointParse(h,a(c).attr("D_key"))||b.control.pointParse(h,a(c).attr("D_key"),Number(a(c).find("input").val())),b.control.pointParse(h,a(c).attr("D_key"),b.control.pointParse(h,a(c).attr("D_key"))+1),a(c).find("input").val(b.control.pointParse(h,a(c).attr("D_key"))),d()}),a(c).find("input").unbind("change").bind("change",function(){b.control.pointParse(h,a(c).attr("D_key"),Number(a(c).find("input").val())),d()})}),a("#scroller [D_type='checkBox']").unbind("tap").bind("tap",function(){var c=this;b.control.pointParse(h,a(c).attr("D_key"))?(b.control.pointParse(h,a(c).attr("D_key"),!1),a(c).removeClass("hl")):(b.control.pointParse(h,a(c).attr("D_key"),!0),a(c).addClass("hl"))}),a("#scroller [D_type='toggle']").each(function(){var c=this;a(c).unbind("tap").bind("tap",function(){b.control.pointParse(h,a(this).attr("D_key"))?(b.control.pointParse(h,a(this).attr("D_key"),!1),a(this).removeClass("hl"),a(this).parents(".list").find(".inputList").hide()):(b.control.pointParse(h,a(this).attr("D_key"),!0),a(this).addClass("hl"),a(this).parents(".list").find(".inputList").show()),myScroll.refresh()})}),a("#scroller .product_input .button").unbind("tap").bind("tap",function(){var d=0,f=1;h.single||(d=h.man+h.child+h.oldman+h.oldman2);var i={a:c.type,b:c.id,c:h.date.b,j:c.state,d1:h.man,d3:h.child,d5:h.child2,d7:h.oldman,d8:h.oldman2,d9:h.man+h.child+h.oldman+h.oldman2},j={d:h.invoice.on?"1":"0",f:h.contract.on?"1":"0",g:h.agree.on?"1":"0",h:h.dsc,i:null,toursParam:[],contactParam:{b:h.linkMan.name,c:h.linkMan.tel,d:h.linkMan.email},addressParam:[],j:g[c.type]};h.invoice.on&&(j.invoiceParam={b:h.invoice.title},j.addressParam.push({b:h.invoice.name,d:h.invoice.place,f:h.invoice.phone})),h.contract.on&&j.addressParam.push({b:h.contract.name,d:h.contract.place,f:h.contract.phone}),a.each(h.traveler,function(a,b){return b.a?void j.toursParam.push(b):(alert("请完成出游人信息"),f=0,!1)}),f&&b.api.run("deal_add","at="+e+"&goParam="+JSON.stringify(i)+"&goiParam="+JSON.stringify(j),function(a){b.cache("pruduct_input_"+c.id,h),window.location.hash="dealSuccess/"+c.id},function(a){alert(JSON.stringify(a))})});setTimeout(function(){myScroll.refresh()},200);a("img").load(function(){myScroll.refresh()})}var f=["","","n","o","p","q"],g={12:"gtcf",13:"gtmd"},h={state:c.state,date:{c:"请选择团期",g:0,h:0,i:0,j:0,k:0,l:0,m:0,n:0,o:0,p:0,q:0},traveler:[],man:1,child:0,child2:0,oldman:0,oldman2:0,single:!0,linkMan:{name:"",tel:"",email:""},invoice:{on:!1,title:"",place:"",name:"",phone:""},contract:{on:!1,place:"",name:"",phone:""},agree:!1,dsc:""};b.cache("pruduct_input_"+c.id)&&(h=b.cache("pruduct_input_"+c.id),b.cache("pruduct_input_"+c.id,null,!0)),console.log(h);var i=_.template(c.tem[0])({left:"",center:"填写订单信息"});a("#head").html(i),a("#head .leftButton").unbind("click").bind("click",function(){window.history.go(-1)}),b.api.at(e)}})}($,app,config);