!function(a,b,c){b.control.set({name:"productInput",par:"type/id/state",tem:["top_second","product_input","pay_list"],fn:function(c){function d(d){function h(h){!g.child&&!g.child2||g.man||(b.pop.on("alert",{text:"儿童必须有成人陪同"}),g.man=1,a("#scroller [d_key='man'] input").val(1)),g.oldman+g.oldman2!==1||g.man||(b.pop.on("alert",{text:"老人必须结伴或由成人陪同"}),g.man=1,a("#scroller [d_key='man'] input").val(1)),g.man+g.child+g.child2+g.oldman+g.oldman2===0&&(b.pop.on("alert",{text:"参团人数至少1人"}),g.man=1,a("#scroller [d_key='man'] input").val(1));var i=0;a("#scroller [D_type='number']").each(function(){i+=Number(a(this).find("input").val()),"0"===a(this).find("input").val()?a(this).find(".numberSub").addClass("disable"):a(this).find(".numberSub").removeClass("disable")});var j=g.man*g.date.g+g.child*g.date.h+g.child2*g.date.i+g.oldman*g.date.j+g.oldman2*g.date.k;g.single&&(j-=(i-g.child2)*g.date.l),i>1&&5>=i?(j-=g.date[e[i]]*i,a("[D_key='sell']").html("￥<span class='numCLASS'>"+g.date[e[i]]*i+"</span>元")):i>5?(j-=g.date.q*i,a("[D_key='sell']").html("￥<span class='numCLASS'>"+g.date.q*i+"</span>元")):a("[D_key='sell']").html("￥<span class='numCLASS'>0</span>元"),a("#scroller .totalPrice").html("￥<span class='numCLASS'>"+j+"</span>"),a("#scroller #totalMan").html("<span class='numCLASS'>"+i+"</span>人"),a("#scroller #traveler").empty(),g.traveler||(g.traveler=[]);for(var k=[],l=0;i>l;l++){var m="";l===i-1&&(m="nb"),k[l]=g.traveler[l]||{b:"姓名"},a("#scroller #traveler").append('<div class="inputList '+m+'"><div class="inputTitle">出游人'+(l+1)+'</div><div class="readonly">'+k[l].b+'</div><div class="clear"></div></div>')}g.traveler=k,a("#scroller [D_type='inputGroup']").unbind("change").bind("change",function(){b.control.pointParse(g,a(this).attr("D_key"))||b.control.pointParse(g,a(this).attr("D_key"),[""]),b.control.pointParse(g,a(this).attr("D_key"))[a(this).attr("D_num")]=a(this).val(),console.log(g)});var n=_.template(c.tem[2])(g);a("#foot").html(n),a("#foot .pay_list .payButton").unbind("tap").bind("tap",function(){if(!g.date.b)return b.pop.on("alert",{text:"请先选择团期"}),!1;if(!g.linkMan.name||!g.linkMan.tel||!g.linkMan.email)return b.pop.on("alert",{text:"请完整填写联系人信息"}),!1;if(!/^1[3|4|5|8][0-9]\d{4,8}$/.test(g.linkMan.tel))return b.pop.on("alert",{text:"联系人手机格式有误"}),!1;if(!/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(g.linkMan.email))return b.pop.on("alert",{text:"联系人邮箱格式有误"}),!1;if(g.invoice.on&&(!g.invoice.title||!g.invoice.place||!g.invoice.phone||!g.invoice.name))return b.pop.on("alert",{text:"如需发票，请完整填写相关信息"}),!1;if(g.invoice.on&&!/^1[3|4|5|8][0-9]\d{4,8}$/.test(g.invoice.phone))return b.pop.on("alert",{text:"发票手机格式有误"}),!1;if(g.contract.on&&(!g.contract.name||!g.contract.phone||!g.contract.place))return b.pop.on("alert",{text:"如需邮寄合同，请完整填写相关信息"}),!1;if(g.contract.on&&!/^1[3|4|5|8][0-9]\d{4,8}$/.test(g.contract.phone))return b.pop.on("alert",{text:"邮寄合同手机格式有误"}),!1;if(!g.agree)return b.pop.on("alert",{text:"必须接受合同条款才能报团"}),!1;var e=0,h=1;g.single||(e=g.man+g.child+g.oldman+g.oldman2);var i={a:c.type,b:c.id,c:g.date.b,j:c.state,d1:g.man,d3:g.child,d5:g.child2,d7:g.oldman,d8:g.oldman2,d9:g.man+g.child+g.oldman+g.oldman2},j={d:g.invoice.on?"1":"0",f:g.contract.on?"1":"0",g:g.agree.on?"1":"0",h:g.dsc,toursParam:[],contactParam:{b:g.linkMan.name,c:g.linkMan.tel,d:g.linkMan.email},addressParam:[],j:f[c.type]};g.invoice.on&&(j.invoiceParam={b:g.invoice.title},j.addressParam.push({b:g.invoice.name,d:g.invoice.place,f:g.invoice.phone})),g.contract.on&&j.addressParam.push({b:g.contract.name,d:g.contract.place,f:g.contract.phone}),a.each(g.traveler,function(a,c){return c.a?void j.toursParam.push(c):(b.pop.on("alert",{text:"请完成出游人信息"}),h=0,!1)}),h&&b.api.run("deal_add","at="+d+"&goparam="+JSON.stringify(i)+"&goiparam="+JSON.stringify(j),function(a){b.cache("pruduct_input_"+c.id,g),window.location.hash="dealSuccess/"+c.id},function(a){b.pop.on("alert",{text:JSON.stringify(a)})})}),myScroll.refresh()}var i=_.template(c.tem[1])(g);a("#scroller").html(i),h(),a("#scroller #postScript").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,g),window.location.hash="postScript/"+c.type+"/"+c.id+"/"+c.state}),a("#scroller #message").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,g),window.location.hash="dealMessage"}),a("#scroller #usefulEmail0").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,g),window.location.hash="usefulEmail/"+c.type+"/"+c.id+"/"+c.state+"/0"}),a("#scroller #usefulEmail1").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,g),window.location.hash="usefulEmail/"+c.type+"/"+c.id+"/"+c.state+"/1"}),a("#scroller #usefulInvoice").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,g),window.location.hash="usefulInvoice/"+c.type+"/"+c.id+"/"+c.state}),a("#scroller #usefulLinkman").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,g),window.location.hash="usefulLinkman/"+c.type+"/"+c.id+"/"+c.state}),a("#scroller #usefulTraveler").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,g),window.location.hash="usefulTraveler/"+c.type+"/"+c.id+"/"+c.state}),a("#scroller #date").unbind("tap").bind("tap",function(){b.cache("pruduct_input_"+c.id,g),window.location.hash="calendar/"+c.type+"/"+c.id+"/"+c.state+"/1"}),a("#scroller [D_type='input']").unbind("change").bind("change",function(){b.control.pointParse(g,a(this).attr("D_key"),a(this).val())}),a("#scroller [D_type='inputGroup']").unbind("change").bind("change",function(){b.control.pointParse(g,a(this).attr("D_key"))||b.control.pointParse(g,a(this).attr("D_key"),[""]),b.control.pointParse(g,a(this).attr("D_key"))[a(this).attr("D_num")]=a(this).val()}),a("#scroller [D_type='number']").each(function(){var c=this;a(c).find(".numberSub").unbind("tap").bind("tap",function(){b.control.pointParse(g,a(c).attr("D_key"))&&b.control.pointParse(g,a(c).attr("D_key"))>0?b.control.pointParse(g,a(c).attr("D_key"),b.control.pointParse(g,a(c).attr("D_key"))-1):b.control.pointParse(g,a(c).attr("D_key"),0),a(c).find("input").val(b.control.pointParse(g,a(c).attr("D_key"))),h()}),a(c).find(".numberAdd").unbind("tap").bind("tap",function(){b.control.pointParse(g,a(c).attr("D_key"))||b.control.pointParse(g,a(c).attr("D_key"),Number(a(c).find("input").val())),b.control.pointParse(g,a(c).attr("D_key"),b.control.pointParse(g,a(c).attr("D_key"))+1),a(c).find("input").val(b.control.pointParse(g,a(c).attr("D_key"))),h()}),a(c).find("input").unbind("change").bind("change",function(){b.control.pointParse(g,a(c).attr("D_key"),Number(a(c).find("input").val())),h()})}),a("#scroller [D_type='checkBox']").unbind("tap").bind("tap",function(){var c=this;b.control.pointParse(g,a(c).attr("D_key"))?(b.control.pointParse(g,a(c).attr("D_key"),!1),a(c).removeClass("hl")):(b.control.pointParse(g,a(c).attr("D_key"),!0),a(c).addClass("hl")),h()}),a("#scroller [D_type='toggle']").each(function(){var c=this;a(c).unbind("tap").bind("tap",function(){b.control.pointParse(g,a(this).attr("D_key"))?(b.control.pointParse(g,a(this).attr("D_key"),!1),a(this).find(".fa").removeClass("hl"),a(this).parents(".list").find(".inputList").hide(),a(this).parents(".list").find(".head").removeClass("bb")):(b.control.pointParse(g,a(this).attr("D_key"),!0),a(this).find(".fa").addClass("hl"),a(this).parents(".list").find(".inputList").show(),a(this).parents(".list").find(".head").addClass("bb")),myScroll.refresh()})}),a("#foot .pay_list .payButton").unbind("tap").bind("tap",function(){if(!g.date.b)return b.pop.on("alert",{text:"请先选择团期"}),!1;if(!g.linkMan.name||!g.linkMan.tel||!g.linkMan.email)return b.pop.on("alert",{text:"请完整填写联系人信息"}),!1;if(!/^1[3|4|5|8][0-9]\d{4,8}$/.test(g.linkMan.tel))return b.pop.on("alert",{text:"联系人手机格式有误"}),!1;if(!/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(g.linkMan.email))return b.pop.on("alert",{text:"联系人邮箱格式有误"}),!1;if(g.invoice.on&&(!g.invoice.title||!g.invoice.place||!g.invoice.phone||!g.invoice.name))return b.pop.on("alert",{text:"如需发票，请完整填写相关信息"}),!1;if(g.invoice.on&&!/^1[3|4|5|8][0-9]\d{4,8}$/.test(g.invoice.phone))return b.pop.on("alert",{text:"发票手机格式有误"}),!1;if(g.contract.on&&(!g.contract.name||!g.contract.phone||!g.contract.place))return b.pop.on("alert",{text:"如需邮寄合同，请完整填写相关信息"}),!1;if(g.contract.on&&!/^1[3|4|5|8][0-9]\d{4,8}$/.test(g.contract.phone))return b.pop.on("alert",{text:"邮寄合同手机格式有误"}),!1;if(!g.agree)return b.pop.on("alert",{text:"必须接受合同条款才能报团"}),!1;var e=0,h=1;g.single||(e=g.man+g.child+g.oldman+g.oldman2);var i={a:c.type,b:c.id,c:g.date.b,j:c.state,d1:g.man,d3:g.child,d5:g.child2,d7:g.oldman,d8:g.oldman2,d9:g.man+g.child+g.oldman+g.oldman2},j={d:g.invoice.on?"1":"0",f:g.contract.on?"1":"0",g:g.agree.on?"1":"0",h:g.dsc,toursParam:[],contactParam:{b:g.linkMan.name,c:g.linkMan.tel,d:g.linkMan.email},addressParam:[],j:f[c.type]};g.invoice.on&&(j.invoiceParam={b:g.invoice.title},j.addressParam.push({b:g.invoice.name,d:g.invoice.place,f:g.invoice.phone})),g.contract.on&&j.addressParam.push({b:g.contract.name,d:g.contract.place,f:g.contract.phone}),a.each(g.traveler,function(a,c){return c.a?void j.toursParam.push(c):(b.pop.on("alert",{text:"请完成出游人信息"}),h=0,!1)}),h&&b.api.run("deal_add","at="+d+"&goparam="+JSON.stringify(i)+"&goiparam="+JSON.stringify(j),function(a){window.location.hash="dealSuccess/"+a.go.x+"/"+a.go.m},function(a){b.pop.on("alert",{text:JSON.stringify(a)})})}),a("#scroller .title_input_list").css({"border-top":"1px solid #dcdcdc"});setTimeout(function(){myScroll.refresh()},200);a("img").load(function(){myScroll.refresh()})}var e=["","","n","o","p","q"],f={12:"gtcf",13:"gtmd"},g={state:c.state,date:{c:"请选择团期",g:0,h:0,i:0,j:0,k:0,l:0,m:0,n:0,o:0,p:0,q:0},traveler:[],man:1,child:0,child2:0,oldman:0,oldman2:0,single:!0,linkMan:{name:"",tel:"",email:""},invoice:{on:!1,title:"",place:"",name:"",phone:""},contract:{on:!1,place:"",name:"",phone:""},agree:!1,dsc:""};b.cache("pruduct_input_"+c.id)&&(g=b.cache("pruduct_input_"+c.id)),console.log(g);var h=_.template(c.tem[0])({left:"",center:"填写订单信息"});a("#head").html(h),a("#head .leftButton").unbind("click").bind("click",function(){window.history.go(-1)}),b.api.at(d)}})}($,app,config);